<br /><br /><br /><br />
<% if flash[:error] %>
<p class="error"><%= flash[:error] %></p>
<% end %>
<p><b>
  <b>User:</b>
  <%= @status_update.user.name %>
</b></p>
<p>
  <b>Body:</b>
  <%= @status_update.body %>
</p>

<p>
  <b>Time:</b>
  <%= @status_update.timestamp.strftime("%I:%M %p %b %d, %Y") %>&nbsp;&nbsp;
  <% i=0 %>
  <% count=0 %>
  <% count = @status_update.likes.count(:all) %>

  <% @like = @status_update.likes.where(:user_id => current_user.id)[0] %>
  <% if @like %>
      <%= link_to 'Unlike', status_update_like_path(@status_update, @like), :method => :delete, :class => "btn btn-link" %>
  <% else %>
      <%= link_to 'Like', new_status_update_like_path(@status_update), :class => "btn btn-link" %>
  <% end %>
  
   | Total Likes : <%= count %>
</p>

<table>
<legend>Comments</legend>
  
  <% @status_update.comments.each do |comment| %>
  <% count=0 %>
  <% j=0 %>
  <p>
    <tr>
      <td><b><%= comment.user.name %> : </b></td>
      <td><%= comment.body %>&nbsp;&nbsp;</td>
      <td><%= comment.timestamp.strftime("%I:%M %p %b %d, %Y") %> | </td>
      <% count = comment.likes.count(:all) %>

      <% @likeComment = comment.likes.where("user_id=?", current_user.id)[0] %>
      <% if @likeComment %>
        <td><%= link_to 'Unlike', status_update_comment_like_comment_path(@status_update, comment, @likeComment), :method => :delete, :class => "btn btn-link" %></td>
      <% else %>
          <td><%= link_to 'Like', new_status_update_comment_like_comment_path(@status_update, comment), :class => "btn btn-link" %></td>
      <% end %>
      <td> |&nbsp; Total Likes : <%= count %></td>
      <% if current_user.id == comment.user_id || current_user.id == @status_update.user_id %>
        <td>&nbsp;| <%= link_to 'Delete', [comment.status_update, comment], :confirm => 'Are you sure?', :method => :delete, :class => "btn btn-link" %></td>
      <% end %>
    </tr>
  </p>
<% end %>
</table>

<legend>Add a comment:</legend>
<%= form_for([@status_update, @status_update.comments.build]) do |f| %>
  <div class="field">
    <%= f.hidden_field(:status_update_id, :value => @status_update.id) %>
  </div>
  
  <div class="field">
    <%= f.hidden_field(:user_id, :value => current_user.id) %>
  </div>

  <div class="field">
    <%= f.label :Comment %>
    <%= f.text_area :body, :cols => "60", :rows => "2", :class => "span6" %>
  </div>
  <div class="field">
    <%= f.hidden_field(:timestamp, :value => Time.now.strftime("%I:%M:%S %p %b %d, %Y")) %>
  </div>
  <div class="actions">
    <%= f.submit :value => "Comment", :class => "btn btn-info" %>
  </div>
<% end %>

<%= link_to 'Back', status_updates_path, :class => "btn btn-link" %>
